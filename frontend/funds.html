<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LifeLink - Funds Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="style.css" rel="stylesheet">
  <link href="navbar.css" rel="stylesheet">
  <link href="language-toggle.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="assets/lifelink-logo.png">
</head>
<body class="fade-out">
  <header class="navbar">
    <nav>
      <a href="index.html" class="logo">
        <img src="assets/lifelink-logo.png" alt="LifeLink" class="nav-logo">
      </a>
      <ul>
        <li><a href="index.html" data-key="nav.home">Home</a></li>
        <li><a href="about.html" data-key="nav.about">About Us</a></li>
        <li><a href="add.html" data-key="nav.add">Add Relief</a></li>
        <li><a href="check.html" data-key="nav.check">Check Relief</a></li>
        <li><a href="funds.html" class="active" data-key="funds.title">Funds Portal</a></li>
      </ul>
    </nav>
  </header>

  <section class="hero fade-up">
    <h1 data-key="funds.title">Funds Portal</h1>
    <p class="tagline" data-key="funds.subtitle">Secure Donations for Disaster Relief</p>
  </section>

  <section class="fade-up">
    <h2 data-key="funds.initSession">1. Initialize Secure Session</h2>
    <input type="text" id="userId" placeholder="Enter your User ID" data-key="funds.userIdPlaceholder">
    <button onclick="initSession()" data-key="funds.startSession">Start Secure Session</button>
    <p id="sessionInfo"></p>
  </section>

  <section class="fade-up">
    <h2 data-key="funds.donate">2. Donate</h2>
    <input type="number" id="amount" placeholder="Amount (INR)" data-key="funds.amountPlaceholder">
    <input type="text" id="purpose" placeholder="Purpose (optional)" data-key="funds.purposePlaceholder">
    <input type="text" id="donorName" placeholder="Your Name" data-key="funds.namePlaceholder">
    <input type="email" id="donorEmail" placeholder="Your Email" data-key="funds.emailPlaceholder">
    <button onclick="donateFunds()" data-key="funds.donateBtn">Donate</button>
    <p id="donateResult"></p>
  </section>

  <section class="fade-up">
    <h2 data-key="funds.viewLedger">3. View Ledger (for demo)</h2>
    <button onclick="viewLedger()" data-key="funds.viewLedgerBtn">View All Donations</button>
    <pre id="ledger"></pre>
  </section>

  <footer>
    <p data-key="footer.copyright">Â© 2025 LifeLink. All rights reserved.</p>
  </footer>

  <script>
    const API = "http://localhost:5000"; // backend API URL

    let userId = null, mac = null, token = null;

    async function initSession() {
      const inputId = document.getElementById("userId").value.trim();
      if (!inputId) return alert("Enter a User ID");

      const res = await fetch(API + "/fundsPortal/init", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId: inputId })
      });
      const data = await res.json();
      if (res.ok) {
        userId = data.userId;
        mac = data.mac;
        token = data.token;
        document.getElementById("sessionInfo").textContent =
          `Session started. MAC: ${mac}, Expires: ${new Date(data.expiresAt).toLocaleString()}`;
      } else {
        alert(data.message || "Error starting session");
      }
    }

    async function donateFunds() {
      if (!userId || !mac || !token) return alert("Start a session first!");
      const amount = document.getElementById("amount").value;
      const purpose = document.getElementById("purpose").value;
      const donorInfo = {
        name: document.getElementById("donorName").value,
        email: document.getElementById("donorEmail").value
      };

      const res = await fetch(API + "/fundsPortal/donate", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-user-id": userId,
          "x-session-mac": mac,
          "x-session-token": token
        },
        body: JSON.stringify({ amount, purpose, donorInfo })
      });
      const data = await res.json();
      document.getElementById("donateResult").textContent =
        res.ok ? "Donation successful. Tx ID: " + data.txId : "Error: " + data.message;
    }

    async function viewLedger() {
      if (!userId || !mac || !token) return alert("Start a session first!");
      const res = await fetch(API + "/fundsPortal/ledger", {
        method: "GET",
        headers: {
          "x-user-id": userId,
          "x-session-mac": mac,
          "x-session-token": token
        }
      });
      const data = await res.json();
      document.getElementById("ledger").textContent =
        res.ok ? JSON.stringify(data, null, 2) : "Error: " + data.message;
    }
  </script>
  <script src="language-translator.js"></script>
</body>
</html>
